<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Włochy — wyszukiwarka placówek oświatowych</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;padding:0;background:#f6f7fb;color:#111}
    header{background:#0b5fff;color:#fff;padding:20px 16px}
    header h1{margin:0;font-size:20px}
    .container{max-width:1000px;margin:20px auto;padding:0 16px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    input[type=text], select{padding:8px;border:1px solid #ccd;padding-left:10px;border-radius:6px;min-width:180px}
    .list{display:grid;grid-template-columns:1fr;gap:12px}
    .card{background:#fff;border-radius:8px;padding:12px;border:1px solid #e1e4ef;box-shadow:0 1px 2px rgba(12,15,30,0.03)}
    .meta{font-size:13px;color:#444;margin-bottom:6px}
    .phone, .address{display:block}
    .actions{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:#0b5fff;color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer}
    .btn.ghost{background:#eef2ff;color:#0b5fff;border:1px solid #dfeaff}
    .opinions{margin-top:8px;background:#fafbff;padding:8px;border-radius:6px;border:1px dashed #e8ecff}
    .opinion{border-top:1px dashed #e8ecff;padding-top:8px;margin-top:8px}
    .small{font-size:13px;color:#666}
    footer{padding:16px;text-align:center;color:#666;font-size:13px}
    .source{font-size:12px;color:#666}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Włochy — wyszukiwarka placówek oświatowych (żłobki, przedszkola, szkoły)</h1>
      <div class="small">Dane pobrane ze stron dzielnicy / DBFO i stron placówek. Proszę zweryfikować przy oficjalnym kontakcie.</div>
    </div>
  </header>

  <main class="container">
    <div class="controls">
      <input id="search" type="text" placeholder="Szukaj nazwy, adresu lub telefonu..." />
      <select id="filter">
        <option value="all">Wszystkie typy</option>
        <option value="żłobek">Żłobek</option>
        <option value="przedszkole">Przedszkole</option>
        <option value="szkoła podstawowa">Szkoła podstawowa</option>
        <option value="liceum / zespół szkół">Liceum / zespół szkół</option>
        <option value="poradnia">Poradnia / inne</option>
      </select>
      <button class="btn" id="clear">Wyczyść</button>
      <button class="btn ghost" id="export">Eksport JSON</button>
    </div>

    <div id="count" class="small"></div>

    <div id="list" class="list"></div>
  </main>

  <footer>
    <div class="source">
      Źródła: <a href="https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" target="_blank">DBFO Włochy — placówki oświatowe</a>,
      <a href="https://wlochy.um.warszawa.pl/szkoly-podstawowe" target="_blank">wlochy.um.warszawa.pl</a>,
      <a href="https://szkola.waw.pl/podstawowa/wlochy" target="_blank">szkola.waw.pl (Włochy)</a>
    </div>
    <div style="margin-top:6px">Data wygenerowania: <!-- will be filled by script --></div>
  </footer>

  <script>
    // Dane placówek (skompilowane z oficjalnych źródeł: DBFO, stron szkół, szkola.waw.pl)
    // Jeśli chcesz dodać więcej placówek, dopisz obiekty do tablicy poniżej.
    const facilities = [
      // Przedszkola (publiczne) - przykłady z DBFO
      { id: "p22", type: "przedszkole", name: "Przedszkole nr 22", address: "ul. Żwirki i Wigury 15b, 02-143 Warszawa", phone: "22 846-20-40", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p29", type: "przedszkole", name: "Przedszkole nr 29", address: "ul. Sycowska 1, 02-266 Warszawa", phone: "22 846-02-33", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p60", type: "przedszkole", name: "Przedszkole nr 60", address: "ul. Rybnicka 42/44, 02-432 Warszawa", phone: "22 863-72-73", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p71", type: "przedszkole", name: "Przedszkole nr 71", address: "ul. Śląska 50/52, 02-462 Warszawa", phone: "22 863-74-51", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p77", type: "przedszkole", name: "Przedszkole nr 77 \"Akademia Pana Kleksa\"", address: "ul. Potrzebna 16, 02-448 Warszawa", phone: "22 863-72-93", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p78", type: "przedszkole", name: "Przedszkole nr 78", address: "ul. Lechicka 12D, 02-156 Warszawa", phone: "22 846-09-61", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p313", type: "przedszkole", name: "Przedszkole nr 313", address: "ul. Sulmierzycka 1, 02-139 Warszawa", phone: "22 846-10-00", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p314", type: "przedszkole", name: "Przedszkole nr 314 (Integracyjne)", address: "ul. 1-Sierpnia 36a, 02-134 Warszawa", phone: "22 886-08-88", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p419", type: "przedszkole", name: "Przedszkole nr 419", address: "ul. Ryżowa 17, 02-489 Warszawa", phone: "22 863 01 27 / 22 863 98 55", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p443", type: "przedszkole", name: "Przedszkole nr 443", address: "ul. Parowcowa 53, 02-440 Warszawa", phone: "668 961 778", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p448", type: "przedszkole", name: "Przedszkole nr 448", address: "ul. Łopuszańska 57A, 02-232 Warszawa", phone: "22 875 15 79", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "p449", type: "przedszkole", name: "Przedszkole nr 449", address: "ul. Krakowiaków 28, 02-255 Warszawa", phone: "", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },

      // Szkoły podstawowe (przykładowe wpisy z DBFO / wlochy.um.warszawa.pl / szkola.waw.pl)
      { id: "sp66", type: "szkoła podstawowa", name: "Szkoła Podstawowa nr 66 im. ks. Juliana Chrościckiego", address: "ul. Przepiórki 16/18, 02-407 Warszawa", phone: "22 863-59-46", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "sp87", type: "szkoła podstawowa", name: "Szkoła Podstawowa z Oddziałami Integracyjnymi nr 87", address: "ul. Malownicza 31, 02-272 Warszawa", phone: "22 846-22-02", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "sp88", type: "szkoła podstawowa", name: "Szkoła Podstawowa nr 88 im. Gabriela Narutowicza", address: "ul. Radarowa 4b, 02-137 Warszawa", phone: "22 846-09-32", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "sp94", type: "szkoła podstawowa", name: "Szkoła Podstawowa nr 94 im. I Marszałka Polski Józefa Piłsudskiego", address: "ul. Cietrzewia 22a, 02-492 Warszawa", phone: "22 863-73-12", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "sp227", type: "szkoła podstawowa", name: "Szkoła Podstawowa nr 227 (Zespół Szkolno-Przedszkolny nr 5)", address: "ul. Astronautów 17, 02-154 Warszawa", phone: "22 846-03-81", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "sp359", type: "szkoła podstawowa", name: "Szkoła Podstawowa nr 359 (Zespół Szkół nr 17)", address: "ul. Promienista 12a, 02-428 Warszawa", phone: "22 863-73-04", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "spo30", type: "szkoła podstawowa", name: "Społeczna Szkoła Podstawowa nr 30 (STO)", address: "ul. Astronautów 11, 02-154 Warszawa", phone: "22 846 01 62 / 22 846 04 83", source: "https://astronautow.szkolnastrona.pl/p,125,osir-dzielnicy-wlochy" },

      // Zespoły szkół / licea
      { id: "narwik", type: "liceum / zespół szkół", name: "Zespół Szkół im. Bohaterów Narwiku", address: "ul. Gładka 16, 02-172 Warszawa", phone: "22 846-09-42", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },
      { id: "clix", type: "liceum / zespół szkół", name: "CLIX Liceum Ogólnokształcące", address: "ul. Solipska 17/19, 02-482 Warszawa", phone: "22 863-77-87", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },

      // Inne (poradnia)
      { id: "ppp22", type: "poradnia", name: "Poradnia Psychologiczno-Pedagogiczna nr 22", address: "ul. Malownicza 31, 02-272 Warszawa", phone: "22 846-19-18", source: "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe" },

      // Prywatne żłobki / przedszkola - przykładowe (należy weryfikować adresy/telefony)
      { id: "anteczek", type: "żłobek", name: "Żłobek / Klub Malucha 'Anteczek' (prywatny)", address: "Włochy, (sprawdź na stronie)", phone: "", source: "https://www.anteczek.pl/" },
      { id: "kochanymaluch", type: "żłobek", name: "Kochany Maluch (prywatny)", address: "Włochy, (sprawdź na stronie)", phone: "", source: "https://www.kochanymaluch.pl/" },
      { id: "zielonawieza", type: "przedszkole", name: "Zielona Wieża (prywatne przedszkole)", address: "Włochy, (sprawdź na stronie)", phone: "", source: "https://zielonawieza.pl/wlochy/" }
    ];

    // LocalStorage klucz opinii
    const STORAGE_KEY = 'wlochy_placowki_opinie_v1';

    // Load opinions from localStorage
    const opinionsStore = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

    // Helpers
    function countVisible(list) {
      return list.length;
    }

    function renderList(items) {
      const listEl = document.getElementById('list');
      listEl.innerHTML = '';
      items.forEach(f => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <strong>${escapeHtml(f.name)}</strong>
              <div class="meta small">${escapeHtml(f.type)} • <span class="source"><a href="${f.source}" target="_blank">źródło</a></span></div>
            </div>
            <div style="text-align:right">
              <div class="small">${escapeHtml(f.address)}</div>
              <div class="small"><span class="phone">tel: ${escapeHtml(f.phone || '—')}</span></div>
            </div>
          </div>
          <div class="actions">
            <button class="btn ghost" data-id="${f.id}" onclick="showOpinionForm('${f.id}')">Dodaj opinię</button>
            <button class="btn" onclick="copyPhone('${f.phone}')">Kopiuj telefon</button>
          </div>
          <div id="opinions-${f.id}" class="opinions">
            ${renderOpinionsHtml(f.id)}
            <div id="opform-${f.id}" style="display:none;margin-top:8px;">
              <label class="small">Ocena: <select id="rating-${f.id}"><option>5</option><option>4</option><option>3</option><option>2</option><option>1</option></select></label>
              <div><textarea id="comment-${f.id}" rows="3" style="width:100%;margin-top:6px;padding:6px;border:1px solid #ddd;border-radius:6px" placeholder="Napisz krótką opinię..."></textarea></div>
              <div style="margin-top:6px"><button class="btn" onclick="saveOpinion('${f.id}')">Zapisz opinię</button> <button class="btn ghost" onclick="hideOpinionForm('${f.id}')">Anuluj</button></div>
            </div>
          </div>
        `;
        listEl.appendChild(card);
      });

      document.getElementById('count').textContent = `Znaleziono: ${items.length} placówek`;
    }

    function renderOpinionsHtml(id) {
      const arr = opinionsStore[id] || [];
      if (!arr.length) return '<div class="small">Brak opinii — bądź pierwszy/a, który oceni!</div>';
      return arr.map(o => `<div class="opinion"><div><strong>Ocena: ${o.rating}/5</strong> <span class="small">— ${escapeHtml(o.date)}</span></div><div>${escapeHtml(o.text)}</div></div>`).join('');
    }

    function showOpinionForm(id) {
      document.getElementById(`opform-${id}`).style.display = 'block';
    }
    function hideOpinionForm(id) {
      document.getElementById(`opform-${id}`).style.display = 'none';
    }

    function saveOpinion(id) {
      const rating = document.getElementById(`rating-${id}`).value;
      const text = document.getElementById(`comment-${id}`).value.trim();
      if (!text) { alert('Proszę wpisać komentarz.'); return; }
      const rec = { rating, text, date: new Date().toLocaleString('pl-PL') };
      opinionsStore[id] = opinionsStore[id] || [];
      opinionsStore[id].unshift(rec);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(opinionsStore));
      // re-render specific opinions
      document.getElementById(`opinions-${id}`).innerHTML = renderOpinionsHtml(id) + document.getElementById(`opform-${id}`).outerHTML;
      // hide form
      hideOpinionForm(id);
      // clear textarea
      const ta = document.getElementById(`comment-${id}`); if (ta) ta.value = '';
      alert('Opinia zapisana (lokalnie w przeglądarce).');
      // full re-render
      applyFilters();
    }

    function copyPhone(phone) {
      if (!phone) { alert('Brak numeru telefonu'); return; }
      navigator.clipboard?.writeText(phone).then(()=>alert('Numer skopiowany: ' + phone)).catch(()=>alert('Kopiowanie nie powiodło się. Skopiuj ręcznie: ' + phone));
    }

    // Search / filtering
    function applyFilters() {
      const q = document.getElementById('search').value.trim().toLowerCase();
      const type = document.getElementById('filter').value;
      let filtered = facilities.filter(f => {
        const matchQ = !q || (f.name && f.name.toLowerCase().includes(q)) || (f.address && f.address.toLowerCase().includes(q)) || (f.phone && f.phone.toLowerCase().includes(q));
        const matchType = (type === 'all') || (f.type === type);
        return matchQ && matchType;
      });
      renderList(filtered);
    }

    // Utility to escape HTML in inserted strings
    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Export JSON
    function exportJson() {
      const data = {
        generatedAt: new Date().toISOString(),
        sourceUrls: [
          "https://www.dbfo-wlochy.waw.pl/placowki-oswiatowe",
          "https://wlochy.um.warszawa.pl/szkoly-podstawowe",
          "https://szkola.waw.pl/podstawowa/wlochy"
        ],
        facilities,
        opinions: opinionsStore
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'wlochy_placowki.json'; document.body.appendChild(a); a.click();
      a.remove(); URL.revokeObjectURL(url);
    }

    // Init
    document.getElementById('search').addEventListener('input', applyFilters);
    document.getElementById('filter').addEventListener('change', applyFilters);
    document.getElementById('clear').addEventListener('click', ()=>{ document.getElementById('search').value=''; document.getElementById('filter').value='all'; applyFilters(); });
    document.getElementById('export').addEventListener('click', exportJson);

    // display date in footer
    document.querySelector('footer div:nth-child(2)').textContent = 'Data wygenerowania: ' + new Date().toLocaleString('pl-PL');

    // initial render
    applyFilters();

    // expose for debugging (optional)
    window._WLOCHY = { facilities, opinionsStore };
  </script>
</body>
</html>
